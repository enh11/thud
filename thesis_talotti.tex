%% Le lingue utilizzate, che verranno passate come opzioni al pacchetto babel. Come sempre, l'ultima indicata sarà quella primaria.
%% Se si utilizzano una o più lingue diverse da "italian" o "english", leggere le istruzioni in fondo.
\def\thudbabelopt{italian,english}
%% Valori ammessi per target: bach (tesi triennale), mst (tesi magistrale), phd (tesi di dottorato).
%% Valori ammessi per aauheader: '' (vuoto -> nessun header Alpen Adria Univeristat), aics (Department of Artificial Intelligence and Cybersecurity), informatics (Department of Informatics Systems). Il nome del dipartimento è allineato con la versione inglese del logo UniUD.
%% Valori ammessi per style: '' (vuoto -> stile moderno), old (stile tradizionale).
\documentclass[target=mst,aauheader=,style=]{thud}

%% --- Informazioni sulla tesi ---
%% Per tutti i tipi di tesi
% Scommentare quello di interesse, o mettete quello che vi pare
\course{Mathematics}
%\course{Internet of Things, Big Data e Web}
%\course{Matematica}
%\course{Comunicazione Multimediale e Tecnologie dell'Informazione}
\title{Removable weak keys for discrete logarithm-based cryptography}
\author{Conte Raffaello Mascetti}
\supervisor{Prof.\ Marino Miculan}
%\cosupervisor{Arch.\ Rambaldo Melandri \and Dott.\ Giorgio Perozzi}
%\tutor{Guido Necchi}
%% Campi obbligatori: \title, \author e \course.
%% Altri campi disponibili: \reviewer, \tutor, \chair, \date (anno accademico, calcolato in automatico), \rights
%% Con \supervisor, \cosupervisor, \reviewer e \tutor si possono indicare più nomi separati da \and.
%% Per le sole tesi di dottorato:
%\phdnumber{313}
%\cycle{XXVIII}
%\contacts{Via della Sintassi Astratta, 0/1\\65536 Gigatera --- Italia\\+39 0123 456789\\\texttt{http://www.example.com}\\\texttt{inbox@example.com}}

%% --- Pacchetti consigliati ---
%% pdfx: per generare il PDF/A per l'archiviazione. Necessario solo per la versione finale
\usepackage[a-1b]{pdfx}
%% hyperref: Regola le impostazioni della creazione del PDF... più tante altre cose. Ricordarsi di usare l'opzione pdfa.
\usepackage[pdfa]{hyperref}
%% tocbibind: Inserisce nell'indice anche la lista delle figure, la bibliografia, ecc.

%% --- Stili di pagina disponibili (comando \pagestyle) ---
%% sfbig (predefinito): Apertura delle parti e dei capitoli col numero grande; titoli delle parti e dei capitoli e intestazioni di pagina in sans serif.
%% big: Come "sfbig", solo serif.
%% plain: Apertura delle parti e dei capitoli tradizionali di LaTeX; intestazioni di pagina come "big".

%%%%%%%5Definizioni,teoremi, proposizioni ...
\usepackage{amsmath,amsfonts,amssymb,amsthm}
\newcommand{\N}{\mathbb{N}}
\newcommand{\Z}{\mathbb{Z}}
\newcommand{\Q}{\mathbb{Q}}
\newcommand{\R}{\mathbb{R}}
\newcommand{\Fp}{\mathbb{F}_{p}}
\newcommand{\Fq}{\mathbb{F}_{q}}
\newcommand{\F}{\mathbb{F}}
\newcommand{\K}{\mathbb{K}}
\newcommand{\clF}{\overline{\F}}
\newcommand{\clK}{\overline{\K}}
\newcommand{\Complessi}{\mathbb{C}}
\newcommand{\infp}{\mathcal{O}}
\theoremstyle{plain}
\newtheorem{teorema}{Theorem}[section]
\newtheorem{proposizione}[teorema]{Proposition}
\newtheorem{lemma}[teorema]{Lemma}
\newtheorem{corollario}[teorema]{Corollary}

\theoremstyle{definition}
\newtheorem{definizione}[teorema]{Definition}
\newtheorem{esempio}[teorema]{Exemple}

\theoremstyle{remark}
\newtheorem{osservazione}[teorema]{Remark}
\DeclareMathOperator{\aut}{Aut}
\DeclareMathOperator{\id}{id}



\begin{document}
\maketitle

%% Dedica (opzionale)
%\begin{dedication}
%	
%\end{dedication}

%%% Ringraziamenti (opzionali)
%\acknowledgements
%

%% Sommario (opzionale)
\abstract


%% Indice
\tableofcontents

%% Lista delle tabelle (se presenti)
%\listoftables

%% Lista delle figure (se presenti)
%\listoffigures

%% Corpo principale del documento
\mainmatter

%% Parte
%% La suddivisione in parti è opzionale; solitamente sono sufficienti i capitoli.
%\part{Parte}

%% Capitolo
\chapter{Arithmetic of Elliptic Curves}
Elliptic curves come up naturally in several branches of mathematics. Here we will follow their development as a branch of arithmetic. 
\section{Background on elliptic curves}
\subsection{Affine equation and group law}
We start with a practical definition of the concept of an elliptic curve. In the following we use the letters $\F,\mathbb{K}\dots$ to denote perfect fields and $\clF,\overline{\mathbb{K}}\dots$ for the corresponding algebraic closure.
\begin{definizione}

An elliptic curve $E$ over a field $\K$, denoted $E/\K$, is given by the $Weierstrass$ $equation$ 
\begin{equation}\label{ell}
	E:y^2 + a_1xy + a_3y = x^3 + a_2x^2+a_4x + a_6,
\end{equation}
where the coefficients $a_1,a_2,a_3,a_4,a_5,a_6\in\K$ are such that for each point $(x_1,y_1)\in\clK$ satisfying (\ref{ell}), the partial derivatives do not vanish simultaneously. In other words the two equations
\begin{equation}\label{jacobi}
	2y+a_1x+a_3=0,\qquad 3x^2+a_2x+a_4-a_1y=0,
\end{equation}
cannot be simultaneously satisfied by any point  $(x_1,y_1)\in\clK$.
\end{definizione}
The last condition says that an elliptic curve is $non$ $singular$ (or $smooth$). A point on a curve is called $singular$ if booth partial derivatives vanish. We can express the smoothness condition more intrinsically. In odd characteristic, the transformation $$x\mapsto x'=x\qquad y\mapsto y'=y+(a_1x+a_3)/2,$$
leads to an isomorphic curve given by 
\begin{equation}
	y^2=x^3+\dfrac{b_2}{4}x^2+\dfrac{b_4}{2}x+\dfrac{b_6}{4},
\end{equation}
where $$b_2=a_1^2+4a_2,\qquad b_4=a_1a_3+2a_4,\qquad b_6=a_3^2+4a_6.$$ Moreover, if the characteristic of $\F$ is neither 2 nor 3, then we can also apply the transformation $$x\mapsto x'=x+\dfrac{b_2}{12},\qquad y\mapsto y'=y$$ which leads to the equation
\begin{equation}
y^2=x^3-\dfrac{c_4}{48}x-\dfrac{c_6}{864},
\end{equation}
where $c_4=b_2^2-24b_4$ and $c_6=-b_2^3+36b_2b_4-216b_6$. So if char($\K$) is prime to 6, we can always assume that an elliptic curve is given by a short Weierstrass equation of the type
\begin{equation}\label{ShortWeierstrass}
	y^2=x^3+a_4x+a_6.
\end{equation}
In this case the smoothness condition is equivalent to requiring that the cubic on the right have no multiple roots. This holds if and only if the discriminant of $x^3+a_4x+a_6$, is nonzero.
\subsection{Projective coordinates}
\begin{definizione}
	Let $\K$ be a field as above and $\clK$ its algebraic closure. The $2-dimentional$ $projective$ $space$ $\mathbb{P}^2/\K:=\mathbb{P}^2$ $over$ $\K$ is the set of classes  of triples $(X,Y,Z)\in\clK^3\setminus \left\{(0,0,0)\right\}$ where two triples are said to be equivalent if they are a scalar multiple of one another; in other words,$$(X_1,Y_1,Z_1)\sim(X_2,Y_2,Z_3)\Leftrightarrow (X_2,Y_2,Z_2)=(kX_1,kY_1,kZ_1)\text{ for some }k\in\clK^*.$$
	The equivalence classes are called $projective$ $point$ and we denote it $(X_1:Y_1:Z_1)$.
\end{definizione}
If a projective point $(X:Y:Z)$ has nonzero $Z$, then there is one and only one triple in its equivalence class of the form $(x,y,1)$ which is obtained by the formula $x=X/Z,y=Y/Z$. Thus, the projective plane can be identified with all points $(x,y)$ of the affine plane plus the points for which $Z = 0$. The latter make up what is called the line at infinity. Any equation $F(x,y) = 0$ of a
curve in the affine plane corresponds to a $homogeneous$ $equation$ $F(X, Y, Z) = 0$ satisfied by the corresponding projective points: simply replace $x$ by $X/Z$ and $y$ by $Y/Z$ and multiply by a power of $Z$ to clear the denominators. In addition to the points
with $Z\neq 0$, what projective points $(X, Y, Z)$ satisfy the homogeneous equation $F(X, Y, Z) = 0$? Setting
$Z = 0$ in the equation, we obtain $0 = X^3$, which leads to $X = 0$. But the
only equivalence class of triples $(X, Y, Z)$ with both $X$ and $Z$ zero is the class
of $(0,1,0)$. This is the point we call $\infp$. It is the point on the intersection of the y-axis with the line at infinity.
Equation $(\ref{ell})$ express the curve in affine coordinates. We can consider the same elliptic curve in projective coordinates; in this case the equation is given by
\begin{equation}\label{ell_proj}
 E_{hom}:Y^2Z+a_1XYZ+a_3YZ^2=X^3+a_2X^2Z+a_4XZ^2+a_6Z^3.
\end{equation}
So we have a correspondence between point of $E_{hom}$ and point of $E$. 

Now we have to decide which Weierstrass equations define isomorphic elliptic curves. We can restrict ourselves to isomorphisms that fix the point at infinity. We shall continue to assume that the characteristic of $\K$ is prime to 6, but actually completely analogous discussions can be done for characteristics 2 and 3 and can be found in [\cite{Sil2}]. We look for invertible transformation of the affine coordinates for
which the transformed equation is again a short Weierstrass form. It easy to see this conditions imposed imply 
$$x\mapsto x'=u^{-2}x\ \text{and}\ y\mapsto y'=u^{-3}y\ \text{with}\ u\in\K^*$$ and the resulting equation is $$E': y'^2=x'^3+u^4a_4x+u^6a_6.$$ We have the following:
\begin{proposizione}\label{classificazione1}
	Let $\K$ be a field with characteristic prime to 6. Let $E/\K$ be an elliptic curves in Weierstrass equation $y^2=x^3+a_4x+a_6$. Then we have:
	\begin{enumerate}
		\item If $a_4=0$ then the coefficient of $x$ is equal to zero in all Weierstrass equations isomorphic to E and $a_6$ is determined up to sixth power in $\K^*$;
		\item  If $a_6=0$ then constant term is zero in all Weierstrass equations isomorphic to E and $a_4$ is determined up to forth power in $\K^*$;
		\item  If $a_4a_6\neq 0$ then $a_6/a_4$ is determined up to a square in $\K^*$;
	\end{enumerate}
And conversely:
\begin{enumerate}
	\item If $a_4=0$ then, $E$ is isomorphic to $E'$ if in a short Weierstrass form of $E'$, the coefficient $a_4'$ is zero and $a_6'/a_6$ is a sixth power in $\K^*$;
	\item If $a_6=0$ then, $E$ is isomorphic to $E'$ if in a short Weierstrass form of $E'$, the coefficient $a_6'$ is zero and $a_4'/a_4$ is a forth power in $\K^*$;
	\item If $a_4a_6\ne 0$ then, $E$ is isomorphic to $E'$ if in a short Weierstrass form of $E'$, we have $a_4'=v^2a_4$ and $a_6'=v^3a_6$ for some $v\in\K^*$.
\end{enumerate}
\end{proposizione}
\begin{corollario}\label{classificazione2}
		Let $\K$ be a field with characteristic prime to 6. Let $E/\K$ be an elliptic curves in Weierstrass equation $y^2=x^3+a_4x+a_6$. Then we have:
\begin{enumerate}
	\item If $a_4=0$, then for every $a_6'\in\K^*$ the curve $E$ is isomorphic to the curve $$E':y^2=x^3+a_6'\ \text{over}\ \K\left(\sqrt[6]{a_6'/a_6}\right)$$
	\item If $a_6=0$, then for every $a_4'\in\K^*$ the curve $E$ is isomorphic to the curve $$E':y^2=x^3+a_4'x\ \text{over}\ \K\left(\sqrt[6]{a_4'/a_4}\right)$$
	\item If $a_4a_6\neq 0$, then for every $v\in\K^*$ the curve $E$ is isomorphic to the curve $$E_v:y^2=x^3+a_4'x+a_6'\ \text{over}\ \K\left(\sqrt{v}\right)\ \text{where}\ a_4'=v^2a_4\ \text{and}\ a_6'=v^3a_6.$$
\end{enumerate}
\end{corollario}
The curve in (\ref{classificazione2}) are called $twists$ $of$ $E$ and the curve $E_u$ is called $quadratic twist$. Note that $E$ is isomorphic to $E_v$ over $\K$ if and only if $v$ is a square in $\K^*$.
	
Now we want to translate the results of proposition \ref{classificazione1}  into "variants" of $E$ that	can be read off from any Weierstrass equation. As stated in the definition of elliptic curves, it has to be smooth, i.e., the roots of the cubic in the right-side of the equation must be simple. This append if and only if the discriminant of the cubic is not equal to zero. 
\begin{definizione}
	Let $E$ be a curve define over $\K$ by the short Weierstrass equations (\ref{ShortWeierstrass}).The $discriminant$ $of$ $the$ $curve$ $E$, denoted by $\Delta_E$ satisfies $$\Delta_E=-(4a_4^3 +27a_6^2).$$ The curve is non-singular, and thus an elliptic curve, is and only if $\Delta_E$ is non-zero. In this case, we introduce the $j-invariant$ of $E$, that is $j_E=\frac{c_4^3}{\Delta_E}=12^3(	?4a_4^3)/\Delta_E.$
\end{definizione}
\begin{lemma}
	Let $\K$ be a field o characteristic prime to 6 and let $E$ be an elliptic curve in short Weierstrass equations $$E:y^2=x^3+a_4x+a_6.$$
	The $j-invariant$ $j_E$ depends only on the isomorphism class of $E$.
	\begin{itemize}
		\item $j_E=0$ if and only if $a_4=0$.
		\item $j_E=12^3$ if and only if $a_6=0$.
		\item If $j\in\K$ is neither $0$ nor $12^3$, then $E$ is a quadratic twist of the elliptic curve $$E_j:y^2=x^3-\dfrac{27j}{4(j-12^3)}x+\dfrac{27j}{4(j-12^3)}.$$
	\end{itemize}
\end{lemma}
\begin{corollario}
	If $\K$ is as above, the isomorphism classes of elliptic curves $E$ over $\K$ are, up to twist, uniquely determined by the invariant $j_E$, and for every $j\in\K$ there exists an elliptic curve with invariant $j$. Moreover, if $K$ is algebraically closed then the isomorphism classes of elliptic curves correspond one-to-one to element in $\K$ via the map $E\mapsto j_E$.
\end{corollario}

\section{The group law}\label{grplaw}
Let $E$ be an elliptic curve over a field $K$ define by the Weierstrass equation $$	E:y^2 + a_1xy + a_3y = x^3 + a_2x^2+a_4x + a_6.$$
We now turn the set of points of $E/\K$ into a group, with operation denoted by $\oplus$. We define the point $\infp$ to be the identity element, it can be visualized as lying far out of the $y$-axis such that any line $x=c$, for some constant $c$, passes through it. If $P=(x,y)$ is any other point then the opposite $\ominus P$ is the point with the same $x$-coordinate as P, but negative $y$-coordinate, i.e., $\ominus P=(x,-y)$. The most natural way to describe the addition law on elliptic curves is to use geometry. To add two generic points $P=(x_1,y_1)$ and $Q=(x_2,y_2)$, we  draw a line connecting them. This line intercept the curve in tree points, namely, $P,Q$ and a third one $R$. We take the point $R$ and we reflect it across the $x$-axis to get a new point $R'$. We define $P\oplus Q=R'$. The same construction can be applied to double a point $P$ where the connecting line is replaced by the tangent at $P$. The above set of rules can be summarized in the following succinct manner:
$$\textit{\text{the sum of the three points where a line intersects the curve is zero}}.$$
If the line passes through the point at infinity $\infp$, then this relation has the form $P\oplus(\ominus P)\oplus\infp=\infp$, otherwise it has the form $P\oplus Q\oplus R=\infp$.\\
We now show why there is exactly one more point where the line through $P$ and $Q$ intersects the curve; at the same time we will derive a formula for the coordinates of this third point, and hence for the coordinates of $P\oplus Q$. Let $\K$ be a field and $E(\K)$ the set of points of an elliptic curve of the form (\ref{ell}). Let $(x_1,y_1),(x_2,y_2)$ and $(x_3,y_3)$ denote the coordinates of $P,Q$ and $P\oplus Q$ respectively. We want to express $x_3$ and $y_3$ 	in terms of $x_1,x_2,y_1,y_2$. Suppose that $P\neq Q$ and $x_1\neq x_2$, than the line through them is not the vertical one, and has slope $$\lambda=\dfrac{y_1-y_2}{x_1-x_2}$$ and passes through $P$, thus its equation is $$y=\lambda x+\dfrac{x_1y_2-x_2y_1}{x_1-x_2}.$$ We denote the constant term by $\mu$ and remark $\mu=y_1+\lambda x_1$. The intersection points with the curve are the solutions of the following cubic equation $$(\lambda x+\mu)^2+(a_1x+a_3)(\lambda x+\mu)=x^3+a_2x^2+a_4x+a_6.$$
This leads to the equation $r(x)=0$ where $$r(x)=x^3+(a_2-\lambda^2-a_1\lambda)x^2+(a_4-2\lambda\mu-a_3\lambda-a_1\mu)x+a_6-\mu^2-a_3\mu.$$ We already know two roots of $r(x)$, namely the $x$-coordinates of the two points $P$ and $Q$, because they lying on the curve and on the line as well. Since the sum of the roots of a monic polynomial is equal to minus the coefficient of the second-to-highest power of the indeterminate $x$, we conclude that the third root in this case is $x_3 = \lambda^2+a_1\lambda -a_2-x_1-x_2$. As $x_1,x_2$ are define over $\K$ so is $x_3$ and $\overline{y}_3=\lambda x + \mu$, thus we found the point $R'=(x_3,\overline{y}_3)$. The inflection at the $x$-axis has to be translated to the condition that the second point has the same $x$-coordinate and also satisfies the curve equation. We observe that if $P=(x_1,y_1)$ is on the curve then so is $(x_1,y_1-a_1x_1-a_3)$, which corresponds to $\ominus P$. Hence we find $y_3=-\lambda x_3-\mu-a_1x_3-a_3$. \\
Doubling $P=(x_1,y_1)$ works in te same way with the slope obtained by implicit derivation. Thus we have $P\oplus Q=(x_3,y_3)$ and 
\begin{align*}
\ominus P &= (x_1,-y_1-a_1x_1-a_3) \\
P\oplus Q &= (\lambda^2+a_1\lambda -a_2-x_1-x_2,\lambda (x_1-x_3)-y_1-a_1x_3-a_3), \text{where}\\
\lambda &=
\begin{cases}
	\dfrac{y_1-y_2}{x_1-x_2} & \text{if } P\neq Q,\\
	\dfrac{3x_1^2+2a_2x_1+a_4-a_1x_1}{2y_1+a_1x_1+a_3} &\text{if } P=Q.
\end{cases}
\end{align*}
The associativity can be shown to hold by simply applying the group law and comparing elements. Moreover it is clear from the geometric construction of the group law, that it is commutative. Thus we have the following.
\begin{proposizione}
	Let $E$ be an elliptic curve over a field $\K$. Then $(E(\clK),\oplus,\infp)$ is an abelian group.
\end{proposizione}
\begin{osservazione}
	 When we consider a point $P$ on $E/\K$, it is implicit that $P$ has its coordinates in $\clK$. To stress that $P$ has its coordinates in $K$. The points lying on $E$ with coordinates in the base field $K$ form the set of $\K-rational$ $points$ $of$ $E$ and we denote it by $E(\K)$. Thus we have $E(\K)=\left\{(x_1,y_1)\in\K^2\ :\ y_1^2+a_1y_1+a_3y_1=x_1^3+a_2x_1^2+a_4x_1+a_6\right\}$, and it is an abelian group as well.
\end{osservazione}
%\begin{esempio}
%In $\Fp$ with prime $p=2857$ the short weierstrass equation $$E:y^2=x^3+3x+7$$ is an elliptic curve, indeed $\Delta=2817\neq 0 \mod p$. The points $P(2760,720)$ and $Q=(688,1288)$ lie on the curve $E(\Fp)$. Then
%\begin{align*}
%\ominus P &= (2760,2137)\\
%P\oplus Q &=(324,1392)\\
%[2]P &= (339,494)
%\end{align*}
%are on $E(\Fp)$. The corresponding projective curve is $$E':ZY^2=x^3+3Z^2X+7Z^3$$. The point $P'=(596,1025,1172)$ lies on the projective curve, in fact it is in the same class as $(2760:720:1)$. 
%\end{esempio}
\subsection{Scalar multiplication}
Let $n\in\N\setminus\left\{0\right\}$. We denote the $scalar$ $multiplication$ $by$ $n$ $on$ $E$ by $\left[n\right]$; namely,
\begin{align*}
\left[n\right]:E/&\K\to E/\K\\
&P\mapsto \left[n\right]P=\underbrace{P\oplus P\oplus\dots\oplus P}_{n\ \text{times}}
\end{align*}
This definition extends trivially to $n\in\Z$ , setting $\left[0\right]P=\infp$ and $\left[n\right]P=\left[-n\right]\ominus P$ for $n$ negative. The kernel of $\left[n\right]$ is $ker\left[n\right]=\left\{P\in E(\clK):\left[n\right]P=\infp\right\}$ and it is denoted by $E\left[n\right]$ and is called $n-torsion$ $subraoup$; its elements are called $n-torsion$ $point$.

We want to describe an algorithm to efficiently compute the scalar multiplication $\left[n\right]P$, which is very important for cryptographic applications. The underlying idea is to write $n$ in binary form as $\sum_{i=0}^{k}2^in_{i}$ with $n_{i}\in\left\{0,1\right\}$ and $k=\lceil\log_2n\rceil$. Next we compute the following quantity:
$$Q_0=P,\ Q_1=2Q_0,\ Q_2=2Q_1,\ldots,\ Q_k=2Q_{k-1}.$$ Notice that $Q_i$ is simply twice the previous $Q_{i-1}$, so $$Q_i=2^iP.$$
This point are referred to as 2-power multiples of $P$, and computing them requires $k$ doublings. Finally, we compute $\left[n\right]P$ using at most $k$ additions,
$$\left[n\right]P=\left[n_0\right]Q_0\oplus\left[n_1\right]Q_1\ldots\oplus\left[n_k\right]Q_k.$$
We'll refer to the addition of two points in $E(\clK)$ as $point$ $operation$.
Thus the total time to compute $\left[n\right]P$ is at most $2k$ point operations in $E(\clK)$. Notice that $2^k\leq n$, so it takes no more than $2\log_2n$ point operations to compute $\left[n\right]P$. This make it feasible to compute $\left[n\right]P$ even for very large values of $n$. We summarize in the following:
\begin{teorema}
Let $E$ be an elliptic curve over $\K$, let $P\in E(\clK)$ and let $n\geq 2$ be an integer. The algorithm described in the table (\ref{doubadd}) computes $\left[n\right]P$ using no more than $\log_2n$ point doublings and no more than $\log_2n$ point additions.
\end{teorema}
\begin{proof}
During the $i^{th}$ iteration of the loop, the value of $Q$ is $\left[2^i\right
]P$. Since $R$ is
incremented by $Q$ if and only if $n_i = 1$, the final value of $R$ is
$$\bigoplus_{i\text{ whit }n_i=1}\left[2^i\right]P=\bigoplus_{i=0}^{k}\left[n_i2^i\right]P=\left[\sum_{i=0}^{k}n_i2^i\right]P=\left[n\right]P.$$
Each iteration of the loop requires one point duplication and at most one point addition, and since $k\leq\log_2n$, the running time of the algorithm is as stated.
\end{proof}
\begin{table}
\caption {Double-and-add algorithm}\label{doubadd}
\begin{center}
\begin{tabular}{|ll|}
\hline
 & INPUT: Point $P\in E(\clK)$ and $n\in\Z$\\
1.& Set $Q=P$ and $R=\infp$.\\
2.&If $n=0$ return $\infp$ and terminate the algorithm \\
3.& Loop while $n>0$\\
 & 4. If $n\equiv 1\mod 2$, set $R=R\oplus Q$.\\
 & 5. Set $Q=\left[2Q\right]$ and $n=\lfloor n/2\rfloor$\\
 & 6. If $n>0$ go to step 2.\\
7.& Return $R$, which is $\left[n\right]P.$\\
\hline
\end{tabular}
\end{center}
\end{table}
The average running time of the double-and-add algorithm to compute $\left[n\right]P$ is $\log_2n$ doublings and $\frac{1}{2}\log_2n$ additions, since the binary expansion of a random integer $n$ has an equal number of 1's and 0's. However we can reduce the average time by using the following expansion of $n$.
\begin{definizione}
A binary representation $(n_{k-1},\dots\,n_1,n_0)$ of an integer $n$ is said to be in $non$ $adiacent$ $form$ provided that no two consecutive $n_i$ are non-zero. Such a representation is denote $NAF$ $representation$.
\end{definizione} 
It is possible to compute the multiple $[n]P$ of the elliptic curve point $P$ by a series of doublings,
additions, and subtractions, using the algorithm in table (\ref{doubaddsub}).
\begin{table}
	\caption {Double-and-add algorithm}\label{doubaddsub}
	\begin{center}
		\begin{tabular}{|ll|}
			\hline
			& INPUT: Point $P\in E(\clK)$ and $(n_{l-1},\dot,n_1,n_0)$ NAF representation on the integer $n$\\
			1.& Set $R=\infp$. \\
			2.& If $n=0$ return $Q$ and terminate the algorithm \\
			3.& For $i$ in $l-1$ down-to $0$ \\
			& 4. Set $R=[2]R.$\\
			& 5. If $n_i=1$ then $R=R\oplus P$.\\
			& 6. Else if $n_i=-1$ then $R=R\ominus P.$\\
			7.& Return $R$, which is $\left[n\right]P.$\\
			\hline
		\end{tabular}
	\end{center}
\end{table}
It is a simple matter to transform a binary representation of a positive integer $n$ into a NAF representation. The basis of this transformation is to replace sub-strings of the form $(0,1,\dots,1)$ in the binary representation by sub-strings of the form $(1,0,\dots,0,-1)$. Such a substitutions do not change the value of $n$, due to the identity $$2^i+2^{i-1}+\dots+2^j=2^{i+1}-2^j$$ where $i>j$. This process is repeated as often as needed, starting with the rightmost (i.e., low-order) bits and proceeding to the left.
\begin{esempio}
The binary expansion of $n=3895$ is $[1, 1, 1,1, 0,0, 1, 1,\underline{0, 1, 1, 1}]$. Starting from the right we substitute the underlined sub-string $[0,1\dots,1]$ with $[1,0,\dots,0,-1]$ and we obtain:
$$[1, 1, 1,1,0,\underline{0, 1, 1, 1}, 0, 0, -1]$$
$$[\underline{1,1,1,1},0, 1,0,0,-1,0,0,- 1,]$$ 
$$[1,0,0,0,-1,0, 1,0,0,-1,0,0,- 1,].$$ This corresponds to $2^12-2^8+2^6-2^3-1=3895$.
\end{esempio}
In a NAF representation, there do not exist two consecutive non-zero coefficients. We might expect that, on average, a NAF representation contains more zeroes than the traditional binary representation of a positive integer. This is indeed
the case: it can be shown [\cite{CiJo}] that, on average, an $k$-bit integer contains $\frac{k}{2}$ zeroes in
its binary representation and $\frac{2k}{3}$ zeroes in its NAF representation.
These results make it easy to compare the average efficiency of the double-and-add using a binary representation to the double-and-add-or-subtract using the NAF representation. Each algorithm requires $k$ doublings, but the number of additions (or subtractions) is $\frac{k}{2}$ in the first case, and $\frac{2k}{3}$ in the second case. If we assume that a doubling takes roughly the same amount of time as an addition (or subtraction), then the ratio of the average times required by the two algorithms is approximately $$\dfrac{k+\frac{k}{2}}{k+\frac{2k}{3}}=\dfrac{9}{8}.$$ We have therefore obtained a (roughly) $11\%$ speedup, on average, by this simple technique.
\section{Elliptic curves over finite field}
For cryptographic applications we are mostly interested in elliptic curves over finite fields. For simplicity, we only consider elliptic curves defined over a finite field $\Fp$ where $p > 3$ is a prime, so we can always assume that $E/\F_p$ is given by a short Weierstrass equation. 
\begin{definizione}
	Let $p > 3$ be a prime. An elliptic curve $E$ over $\Fp$ is given by the short Weierstrass equation
	$$y^2 = x^3 + a_4x + a_6,$$ where $\ a_4,a_6\in\Fp$ satisfy $4a_4^3+27a_6^2\neq 0 \mod p.$ 
\end{definizione}
In the previous section \ref{grplaw} we explained the group law in general. Here we shall give formulas for determine the coordinates of the result of the 
\begin{itemize}
	\item addition of two points $P$ and $Q$ in $E(\Fp)$ provided that $P\neq Q$ and $P\neq\ominus Q$,
	\item doubling of $P$.
	%\footnote{You can find and implementation of these formulas written in Rust on my repository [\cite{repo}]. I used at first the affine coordinates formulas  }
\end{itemize} 

%% Fine dei capitoli normali, inizio dei capitoli-appendice (opzionali)
\appendix

%\part{Appendici}

%\chapter{Titolo della prima appendice}
%

%% Parte conclusiva del documento; tipicamente per riassunto, bibliografia e/o indice analitico.
\backmatter

%% Riassunto (opzionale)
%\summary


%% Bibliografia (praticamente obbligatoria)
\bibliographystyle{plain_\languagename}%% Carica l'omonimo file .bst, dove \languagename è la lingua attiva.
%% Nel caso in cui si usi un file .bib (consigliato)
\bibliography{thud}
%% Nel caso di bibliografia manuale, usare l'environment thebibliography.

%% Per l'indice analitico, usare il pacchetto makeidx (o analogo).

\end{document}

--- Istruzioni per l'aggiunta di nuove lingue ---
Per ogni nuova lingua utilizzata aggiungere nel preambolo il seguente spezzone:
    \addto\captionsitalian{%
        \def\abstractname{Sommario}%
        \def\acknowledgementsname{Ringraziamenti}%
        \def\authorcontactsname{Contatti dell'autore}%
        \def\candidatename{Candidato}%
        \def\chairname{Direttore}%
        \def\conclusionsname{Conclusioni}%
        \def\cosupervisorname{Co-relatore}%
        \def\cosupervisorsname{Co-relatori}%
        \def\cyclename{Ciclo}%
        \def\datename{Anno accademico}%
        \def\indexname{Indice analitico}%
        \def\institutecontactsname{Contatti dell'Istituto}%
        \def\introductionname{Introduzione}%
        \def\prefacename{Prefazione}%
        \def\reviewername{Controrelatore}%
        \def\reviewersname{Controrelatori}%
        %% Anno accademico
        \def\shortdatename{A.A.}%
        \def\summaryname{Riassunto}%
        \def\supervisorname{Relatore}%
        \def\supervisorsname{Relatori}%
        \def\thesisname{Tesi di \expandafter\ifcase\csname thud@target\endcsname Laurea\or Laurea Magistrale\or Dottorato\fi}%
        \def\tutorname{Tutor aziendale%
        \def\tutorsname{Tutor aziendali}%
    }
sostituendo a "italian" (nella 1a riga) il nome della lingua e traducendo le varie voci.
